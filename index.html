<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Knowledge Base</title>
    
    <!-- REQUIRED: n8n Chat Style Sheet -->
    <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />

    <style>
        :root {
            --primary-color: #8D56FD;
            --primary-hover: #7339ea;
            --bg-color: #f4f6f8;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-radius: 12px;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            width: 100%;
            background: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
            margin-bottom: 30px;
        }

        h1 { margin: 0; font-size: 1.5rem; color: var(--primary-color); }

        .main-container {
            width: 95%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 50px;
        }

        @media (min-width: 900px) {
            .main-container { grid-template-columns: 350px 1fr; }
        }

        .card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            height: 600px; /* Match height for alignment */
            display: flex;
            flex-direction: column;
        }

        h2 { font-size: 1.1rem; margin-top: 0; margin-bottom: 15px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }

        /* Upload Styling */
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            transition: border-color 0.3s;
            margin-bottom: 15px;
            cursor: pointer;
        }
        .upload-area:hover { border-color: var(--primary-color); }
        input[type="file"] { display: none; }
        .file-label { background-color: #eee; padding: 10px 20px; border-radius: 4px; font-weight: bold; }
        #file-name { margin-top: 15px; font-size: 0.85rem; color: #666; }

        .btn-primary {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        .btn-primary:disabled { background-color: #ccc; }

        /* Chat Container - CRITICAL: Must have height */
        #n8n-chat-container {
            flex-grow: 1;
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #eee;
        }

        .status-msg { margin-top: auto; padding-top: 10px; font-size: 0.9rem; text-align: center; }
    </style>
</head>
<body>

    <header>
        <h1>‚ú® AI Document Assistant</h1>
    </header>

    <div class="main-container">
        
        <!-- LEFT: Upload -->
        <div class="card">
            <h2>üìÅ 1. Add Knowledge</h2>
            <p style="font-size: 0.9rem; color: #666;">Upload a PDF to store it in Pinecone.</p>

            <label for="pdfInput" class="upload-area">
                <span class="file-label">Select PDF File</span>
                <input type="file" id="pdfInput" accept=".pdf" onchange="showFileName()">
                <div id="file-name">No file selected</div>
            </label>

            <button onclick="uploadFile()" id="uploadBtn" class="btn-primary">Upload & Index</button>
            <div id="status" class="status-msg"></div>
        </div>

        <!-- RIGHT: Chat -->
        <div class="card">
            <h2>üí¨ 2. Chat with Documents</h2>
            <div id="n8n-chat-container"></div>
        </div>

    </div>

    <script>
        /**
         * CONFIGURATION
         * 1. Get UPLOAD_URL from your "Webhook1" node (Test URL first).
         * 2. Get CHAT_URL from your "Chat Trigger" node (Production/Test URL).
         */
        const UPLOAD_URL = "http://localhost:5678/webhook/f8ffffb0-30e2-472a-8a84-b427401bf8a6/chat"; 
        const CHAT_URL   = "http://localhost:5678/webhook/f8ffffb0-30e2-472a-8a84-b427401bf8a6/chat";

        function showFileName() {
            const input = document.getElementById('pdfInput');
            document.getElementById('file-name').textContent = input.files.length ? input.files[0].name : "No file selected";
        }

        async function uploadFile() {
            const fileInput = document.getElementById('pdfInput');
            const status = document.getElementById('status');
            const btn = document.getElementById('uploadBtn');

            if (!fileInput.files.length) {
                status.textContent = "‚ö†Ô∏è Select a PDF first.";
                status.style.color = "orange";
                return;
            }

            btn.disabled = true;
            btn.textContent = "Processing...";
            status.textContent = "‚è≥ Sending to n8n...";

            const formData = new FormData();
            // This key "data" should match the "Binary Property" in your n8n extraction node
            formData.append("data", fileInput.files[0]); 

            try {
                const response = await fetch(UPLOAD_URL, { method: "POST", body: formData });
                if (response.ok) {
                    status.textContent = "‚úÖ Indexed Successfully!";
                    status.style.color = "green";
                    fileInput.value = "";
                } else {
                    status.textContent = "‚ùå Error: " + response.statusText;
                    status.style.color = "red";
                }
            } catch (e) {
                status.textContent = "‚ùå Connection Failed. Is n8n running?";
                status.style.color = "red";
            } finally {
                btn.disabled = false;
                btn.textContent = "Upload & Index";
            }
        }
    </script>

    <!-- REQUIRED: n8n Chat Bundle -->
    <script type="module">
        import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

        createChat({
            webhookUrl: CHAT_URL,
            target: '#n8n-chat-container',
            mode: 'fullscreen',
            showWelcomeScreen: false,
            initialMessages: ['Hi! Upload a document on the left, then ask me anything about it.'],
            i18n: { en: { title: 'AI Assistant', subtitle: 'Powered by n8n' } }
        });
    </script>
</body>
</html>